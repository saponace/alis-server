  # Finances management
  firefly_iii_app:
    container_name: firefly_iii_app
    image: jc5x/firefly-iii:%VERSION%
    restart: unless-stopped
    networks:
      - firefly_iii_net
      - default
    volumes:
      - %FIREFLY_DATA%/export:/var/www/firefly-iii/storage/export
      - %FIREFLY_DATA%/upload:/var/www/firefly-iii/storage/upload
    environment:
      - DB_HOST=firefly_iii_db
      - DB_CONNECTION=pgsql
      - DB_DATABASE=%DB_NAME%
      - DB_USERNAME=%DB_USERNAME%
      - DB_PASSWORD=%DB_PWD%
      - APP_KEY=%APP_KEY%
      - APP_ENV=local
      - TZ=%TIMEZONE%
      - TRUSTED_PROXIES=**
      - APP_DEBUG=true
      - APP_LOG_LEVEL=debug
      - LOGIN_PROVIDER=ldap
      - ADLDAP_CONNECTION_SCHEME=OpenLDAP
      - ADLDAP_AUTO_CONNECT=true
      - ADLDAP_CONTROLLERS=openldap
      - ADLDAP_PORT=389
      - ADLDAP_TIMEOUT=5
      - ADLDAP_BASEDN="dc=EXAMPLE,dc=TLD" # TODO: var
      - ADLDAP_FOLLOW_REFFERALS=false
      - ADLDAP_USE_SSL=false
      - ADLDAP_USE_TLS=false
      - ADLDAP_ADMIN_USERNAME="cn=ADMIN,dc=EXAMPLE,dc=TLD" # TODO: var
      - ADLDAP_ADMIN_PASSWORD=ADMINPWD # TODO: var
      - ADLDAP_ACCOUNT_PREFIX="cn="
      - ADLDAP_ACCOUNT_SUFFIX=",ou=users,dc=domain,dc=com" # TODO: var
      # Setting the following two fields to true sync the LDAP passwords to Firefly III database to allow connection to
      # Firefly III when the LDAP server is down
      - ADLDAP_PASSWORD_SYNC=false
      - ADLDAP_LOGIN_FALLBACK=false
      - ADLDAP_DISCOVER_FIELD=cn
      - ADLDAP_AUTH_FIELD=cn
      - ADLDAP_SYNC_FIELD=cn
    labels:
      - traefik.enable=true
      - traefik.http.routers.firefly.rule=Host(`firefly.%DOMAIN_NAME%`)
      - traefik.http.services.firefly.loadbalancer.server.port=80
      - traefik.http.routers.firefly.tls.certresolver=le
